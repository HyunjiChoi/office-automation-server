<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.caddie.voice.y1.dao.SalesDao">

    <select id="getSalesByCalDtAndLnPartner" resultType="ExcelData">
        select *
        from SALES
        where CAL_DT = #{calDt} and LN_PARTNER = #{lnPartner} and DEL_FLAG = 'N'
    </select>

    <select id="SalesCalDt" resultType="String">
        SELECT
            DISTINCT (CAL_DT)
        FROM
            WORKST_S
        WHERE
            DEL_FLAG = 'N'
        GROUP BY
            CAL_DT
        ORDER BY
            CAL_DT DESC
    </select>

    <select id="SalesLnPList" resultType="String">
        SELECT
            LN_PARTNER
        FROM
            WORKST_S
        WHERE
            DEL_FLAG = 'N' AND CAL_DT = #{calDt}
        ORDER BY
            CAL_DT
    </select>


    <select id="deregisterSales" resultType="SalesList">
         UPDATE
             SALES
         SET
             DEL_FLAG = 'Y'
         WHERE
             CAL_DT = #{calDt}


    </select>

    <select id="deregisterSalesWorkSt" resultType="SalesList">
        UPDATE
            WORKST_S
        SET
            DEL_FLAG = 'Y'
            , WO_CNT = 0
        WHERE
            CAL_DT = #{calDt}

    </select>


    <select id="salesDetail" resultType="SalesDetail">
        SELECT
            CAL_MONTH,
            CAL_DAY,
            SALES_TYPE,
            AP,
            NO_ORDER,
            LN_PARTNER,
            NM_SPITEM,
            CM,
            COLOR,
            QT_SO,
            CA,
            VAT,
            PRICE,
            SUM,
            ETC,
            NM_CUST,
            CAL_WH
        FROM
            SALES
        WHERE
              CAL_DT = #{calDt} AND DEL_FLAG='N'

    </select>


    <insert id="InsertSalesExcelData" parameterType="ExcelData">
        INSERT INTO
            SALES
                (
                   CAL_DT,
                   MARKET_CD,
                   CAL_MONTH,
                   CAL_DAY,
                   SALES_TYPE,
                   AP,
                   NO_ORDER,
                   LN_PARTNER,
                   NM_SPITEM,
                   CM,
                   COLOR,
                   QT_SO,
                   CA,
                   VAT,
                   PRICE,
                   SUM,
                   ETC,
                   NM_CUST,
                   CAL_WH
                )
        VALUES
               (
                    #{calDt},
                    #{marketCd},
                    #{calMonth},
                    #{calDay},
                    #{salesType},
                    #{ap},
                    #{noOrder},
                    #{lnPartner},
                    #{nmSpitem},
                    #{cm},
                    default,
                    #{qtSo},
                    #{ca},
                    #{vat},
                    #{price},
                    #{sum},
                    default,
                    #{nmCust},
                    #{calWh}
                )
        ON DUPLICATE KEY
        UPDATE
            DEL_FLAG = 'N'
    </insert>

    <insert id="SalesWorkStData" parameterType="WorkSt_S">
        INSERT INTO WORKST_S
        VALUES (
                #{calDt},
                #{marketCd},
                #{lnPartner},
                default,
                default,
                default,
                default,
                default
                )
        ON DUPLICATE KEY
        UPDATE
            DEL_FLAG = 'N',
            WO_CNT = WO_CNT + 1;
    </insert>

</mapper>